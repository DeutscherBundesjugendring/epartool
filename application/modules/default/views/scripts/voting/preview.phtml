<?php
    $settings = $this->settings;
    $this->layout()->settings = $settings;
    $this->layout()->labels = $array = explode (',', $settings['btn_labels']);
?>

<?php echo $this->secondNavigation('voting') ?>

<div class="content-holder">
    <div class="row">
        <aside class="span3">
            <a href="<?php echo $this -> url(array('action' => 'overview')); ?>">
                <i class="icon-reply"></i> <?=$this->translate('Continue voting')?>
            </a>
            <br />
            <a href="<?php echo $this -> url(array('action' => 'stopvoting')); ?>">
                <i class="icon-signout"></i> <?=$this->translate('Finish voting')?>
            </a>

        </aside>

        <section class="main-content span9">
            <small class="muted">
                <?=sprintf($this->translate('You have already voted on %s out of %s contributions.'), $this->escape($this->votedInputs), $this->escape($this->votableInputs))?>
            </small>

            <h1><?=$this->translate('Overview of your votes')?></h1>
            <p>
                <?=$this->translate('Here you can see all contributions to be voted and your votes. You can still change your votes if you like.')?>
            </p>

            <!-- Questions -->
            <?php echo $this ->partialLoop('_partials/voting/votingPreviewItem.phtml', $this->questions); ?>

            <?php echo $this->render('_partials/printLink.phtml') ?>

        </section>
    </div><!-- .row -->
</div><!-- .content-holder -->

<?php echo $this->render('_partials/topLink.phtml') ?>


<script type="text/javascript">
    $(document).ready(function() {

        $(document).on("click",".voting-statement", function(event) {
            event.preventDefault();
            var statementId = $(this).attr('rel');
            var points = $(this).attr('data');

            $.ajax({
                url: "/voting/previewfeedback/kid/<?php echo $this->escape($this -> consultation -> kid); ?>/id/" + statementId + "/points/" + points,
                type: "POST",
                data: "format=html",
                cache: false,
                async: "true",
                error: function(){
                    document.getElementById('statement-' + statementId).innerHTML = "<?=$this->translate('An error occurred')?>";
                },
                beforeSend: function(){
                    document.getElementById('statement-' + statementId).innerHTML = "<?=$this->translate('Please wait…')?>";
                },
                success:function(response){
                    document.getElementById('statement-' + statementId).innerHTML = response;
                }
            });
        });

        $(document).on("click",".voting-particularly-important", function(event) {
            event.preventDefault();
            var statementId = $(this).attr('rel');
            var points = $(this).attr('data');

            $.ajax({
                url: "/voting/previewfeedbackpi/kid/<?php echo $this->escape($this -> consultation -> kid); ?>/id/" + statementId + "/points/" + points,
                type: "POST",
                data: "format=html",
                cache: false,
                async: "true",
                error: function(){
                    document.getElementById('statement-' + statementId).innerHTML = "<?=$this->translate('An error occurred')?>";
                },
                beforeSend: function(){
                    document.getElementById('statement-' + statementId).innerHTML = "<?=$this->translate('Please wait…')?>";
                },
                success:function(response){
                    document.getElementById('statement-' + statementId).innerHTML = response;
                }
            });
        });

    });
</script>
