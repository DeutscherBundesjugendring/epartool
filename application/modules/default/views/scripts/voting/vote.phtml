<?php
/**
 * index
 *
 * @description   Voting-site
 * @author        Jan Suchandt
 */
?>

<?php echo $this->secondNavigation('voting') ?>

<div class="content-holder main-content">

	<h1 class="heading-centered">Abstimmung zu &quot;<?php echo $this->consultation->titl; ?>&quot;</h1>

	<div class="row">
		<div class="span9 offset1">

			<?php if ($this->noMoreThesis): ?>

				<p>In dieser Kategorie gibt es keine Beiträge mehr zum Abstimmen. Bitte wechsle zu einer anderen Frage oder einem anderen Schlagwort.</p>
				<a href="<?php echo $this->url(array('controller' => 'voting', 'action' => 'overview', 'kid' => $this->consultation->kid), null, true); ?>"
				   class="btn">Frage / Schlagwort wechseln</a>

				<a href="<?php echo $this->url(array('action' => 'stopvoting')); ?>" class="btn" title="Abstimmung beenden">Beenden</a>

			<?php else: ?>

				<div class="well well-large voting text-center">
					<span class="label sticker label-mitmachen-black hidden-print">Mitmachen!</span>
					<!--  @TODO change url to last input of voting -->

					<span class="voting-counter">
						<?php
						// Add leading zeros to count voted
						$countTotal = $this->thesesCount;
						$countVoted = $this->thesesCountVoted;

						if (strlen($countTotal) > strlen($countVoted)) {
							$format = '%0' . strlen($countTotal) . 'd';
							$countVoted = sprintf($format, $countVoted);
						}

						// Print count voted by number
						$countVoted = str_split($countVoted);
						foreach ($countVoted as $number) {
							echo '<span class="voting-counter-digit">' . $number . '</span>';
						}
						?>
						von <?php echo $countTotal; ?> Beiträgen<br />
						zu dieser Frage abgestimmt
					</span>

					<h2>Stimme jetzt ab!</h2>

					<h3><?php echo $this->question['nr'] . ' ' . $this->question['q']; ?>
						<?php
						if (!empty($this->thesis['tagname_de'])) {
							echo('(Schlagwort: ' . $this->thesis['tagname_de']. ')');
						}
						?>
					</h3>
					<p class="voting-thesis"><?php echo $this->thesis['thes']; ?></p>
					<?php if (!empty($this->thesis['expl'])): ?>
					<p class="voting-expl"><?php echo $this->escape($this->thesis['expl']); ?></p>
					<?php endif ?>

					<div class="voting-rating-bar">
						<?php
						// Show back-button
						if (!empty($this->LastVote)) {
							if ($this->thesis['tid'] !== $this->LastVote[0]['tid']) {
								?>
								<a href="<?php echo $this->url(array('kid' => $this->consultation->kid, 'tid' => $this->LastVote[0]['tid'], 'qid' => $this->LastVote[0]['qi'])); ?>"
								   class="btn btn-small btn-light voting-prev"><i class="icon-angle-left icon-large"></i> Rückgängig</a>
								<?php
							}
						}
						?>

						<p><strong>Wie wichtig findest du diesen Beitrag für die weitere politische Diskussion zum Thema?</strong></p>
					</div>
					<?php
					$settings = $this->settings;
					$this->layout()->settings = $settings;
					$this->layout()->lables = $array = explode (',', $settings['btn_lables']);
					echo $this ->partial('_partials/voting/votingButtons.phtml', $this); ?>
					<p>
						<a href="<?php echo $this->url(array('controller' => 'voting', 'action' => 'overview', 'kid' => $this->consultation->kid), null, true); ?>"
						   id="buttonChangeKeyword" class="btn">Frage / Schlagwort wechseln</a>
					</p>

					<a href="<?php echo $this->url(array('action' => 'stopvoting')); ?>" title="Abstimmung beenden"><i class="icon-signout"></i> Abstimmung beenden</a>
					<a href="<?php echo $this -> url(array('action' => 'preview')); ?>" title="Abstimmung beenden"><i class="icon-signout"></i> Vorschau Abstimmung</a>

				</div><!-- .well -->

			<?php endif; ?>

		</div>
	</div><!-- .row -->

</div><!-- .content-holder -->

<?php echo $this->render('_partials/topLink.phtml') ?>
