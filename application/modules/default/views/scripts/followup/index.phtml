<?php
    $date = new Zend_Date();
    $locale = new Zend_Locale();
?>

<?=$this->secondNavigation('follow-up');?>

<div class="main-content">
    <div class="row">
        <div class="sidebar-left hidden-print">

            <?=$this->followupNavigation('overview');?>

        </div>
        <div class="content">

            <h1>
                <?=$this->translate('How it all proceeeded:');?>
                <br />
                <?=$this->translate('Reactions & Impact');?>
            </h1>

            <?php if ($this->consultation['follow_up_explanation']): ?>
                <p class="offset-bottom-large">
                    <?=$this->consultation['follow_up_explanation'];?>
                </p>
            <?php endif;?>

            <!-- All followups -->
            <div class="well well-bordered text-center offset-bottom-large has-sticker">

                <!-- Sticker -->
                <div class="sticker sticker-right hidden-print">
                    <div class="sticker-label sticker-label-accent">
                        <?=$this->translate('Reaction');?>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-8 col-sm-offset-2">

                        <h2 class="well-title offset-bottom-large"><?=$this->translate('Overview of reactions so far:')?></h2>

                    </div>
                </div><!-- .row -->

                <?php if (!empty($this->followups)): ?>
                    <div id="followup" class="row-horizontal-sm">

                        <div class="row">

                            <?php foreach ($this->followups as $followup): ?>
                                <div class="col-sm-4">

                                    <div class="card text-left offset-bottom-large">
                                        <h4 class="card-title">
                                            <?=$followup['titl'];?>
                                        </h4>
                                        <div class="offset-bottom-small">
                                            <img
                                                class="followup-well-link img-responsive followup-timeline-box js-openoverlay js-timeline-box"
                                                data-href="<?=$this->url(['action' => 'json', 'ffid' => (int) $followup['ffid'], 'fid' => null, 'tid' => null, 'page' => null]);?>"
                                                data-ffid="<?=(int) $followup['ffid'];?>"
                                                src="<?=$this->mediaCnsltDir . $followup['gfx_who'];?>" alt="<?=$this->translate('Preview');?>"
                                            />
                                        </div>
                                        <time class="text-muted">
                                            <?php
                                            if ($followup['show_no_day'] === "y") {
                                                echo strftime("%m/%Y", strtotime($followup['when']));
                                            } else
                                                echo strftime("%d.%m.%Y", strtotime($followup['when']));
                                            ?>
                                        </time>
                                        <p class="card-description small offset-bottom-small">
                                            <?=$followup['who'];?>
                                        </p>
                                        <span class="glyphicon glyphicon-menu-right icon-offset text-muted" aria-hidden="true"></span>
                                        <button
                                            class="btn-link followup-timeline-box js-openoverlay js-timeline-box"
                                            data-href="<?=$this->url(['action' => 'json', 'ffid' => (int) $followup['ffid'], 'fid' => null, 'tid' => null, 'page' => null]);?>"
                                            data-ffid="<?=(int) $followup['ffid'];?>"
                                        >
                                            <?=$this->translate('View');?>
                                        </button>
                                        <?php if ($followup['referenceType'] === 'file'): ?>
                                            <form method="post" action="<?= $this->url(['action' => 'download', 'page' => null]);?>">
                                                <input type="hidden" name="filename" value="<?=$followup['ref_doc'];?>" />
                                                <span class="glyphicon glyphicon-file icon-offset text-muted" aria-hidden="true"></span>
                                                <button type="submit" class="btn-link">
                                                    <?=$this->translate('Download');?>
                                                </button>
                                            </form>
                                        <?php endif; ?>

                                    </div><!-- .card -->

                                </div>
                            <?php endforeach; ?>

                        </div>

                    </div><!-- .row -->

                    <!-- Loader -->
                    <div id="followuploader"><?=$this->translate('Loadingâ€¦');?></div>
                <?php else: ?>
                    <p class="alert alert-info text-left">
                        <span class="glyphicon glyphicon-info-sign icon-offset" aria-hidden="true"></span>
                        <?=$this->translate('There are no reactions yet.');?>
                    </p>
                <?php endif; ?>
                <?=$this->subscriptionForm;?>

            </div><!-- .well -->

            <!-- Followups by contribution -->
            <div class="well well-bordered text-center has-sticker">

                <!-- Sticker -->
                <div class="sticker sticker-right hidden-print">
                    <div class="sticker-label sticker-label-accent">
                        <?=$this->translate('Reaction');?>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-8 col-sm-offset-2">

                        <h2 class="well-title offset-bottom-large"><?=$this->translate('Reactions and Feedback on individual contributions');?></h2>

                    </div>
                </div><!-- .row -->

                <p>
                    <?=$this->translate('Simply click on respective question or switch to keywords.');?>
                </p>

                <?=$this->questionNavigation(null, 'follow-up-box');?>
                <br/>

                <a href="<?=$this->url(['action' => 'tags', 'page' => null]);?>" class="btn btn-default">
                    <span class="glyphicon glyphicon-tag icon-offset icon-shift-down" aria-hidden="true"></span>
                    <?=$this->translate('Sorted by keywords');?>
                </a>

            </div><!-- .well-large-alt -->

        </div>
    </div><!-- .row -->

    <?=$this->partial('_partials/pageLinks.phtml', ['help' => 'help-text-consultation-followup']);?>

</div><!-- .main-content -->
