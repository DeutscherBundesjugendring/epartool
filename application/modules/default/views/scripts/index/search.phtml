<?php
/**
 * search
 *
 * @description   Overview of search results
 * @author        Jan Suchandt
 */
?>

<div class="content-holder main-content">

    <article class="article article-detail">
        <h1>Suche nach &quot;<?php echo $this->needle; ?>&quot;</h1>

        <h2>Suche in Grundinformationen</h2>
        <?php if (count($this->resultsGeneral) > 0): ?>
                <?php $staticArticles = array(
                    'about', 'imprint', 'faq', 'privacy', 'contact'
                );?>
                <ul>
                    <?php foreach ($this->resultsGeneral AS $article): ?>
                        <li>
                            <a
                                href="<?php echo in_array($article['ref_nm'], $staticArticles) ? $this->baseUrl() . '/' . $article['ref_nm'] : $this->baseUrl() . '/article/show/aid/' . $article['art_id']?>"
                                title="<?php echo $article['desc']?>"
                            >
                                <?php echo $article['desc']?>
                            </a>
                       </li>
                    <?php endforeach?>
                </ul>
        <?php else: ?>
            <ul><li>Es wurden keine relevanten Ergebnisse mit diesem Suchbegriff gefunden.</li></ul>
        <?php endif ?>


        <h2>Suche in Beteiligungsrunden</h2>
        <?php if (count($this->resultsConsultations) > 0): ?>
            <?php foreach ($this->resultsConsultations AS $consultation): ?>
                <?php if (
                    count($consultation['articles']) > 0
                    || count($consultation['questions']) > 0
                    || count($consultation['inputs']) > 0
                    || isset($consultation['inExpl']))
                : ?>
                    <h3><?php echo $consultation['titel']?></h3>

                    <?php if (count($consultation['articles']) > 0 || isset($consultation['inExpl'])): ?>
                        <h4>Informationsseiten</h4>
                        <ul>
                            <?php if (isset($consultation['inExpl'])): ?>
                                <li>
                                    <a href="<?php echo $this->baseUrl()?>/article/index/kid/<?php echo $consultation['cid']?>" title="Übersichtsseite">
                                        Übersichtsseite
                                    </a>
                                </li>
                            <?php endif?>
                            <?php foreach ($consultation['articles'] AS $article): ?>
                                <li>
                                    <a
                                        href="<?php echo $this->baseUrl()?>/article/show/kid/<?php echo $consultation['cid']?>/aid/<?php echo $article['art_id']?>"
                                        title="<?php echo $article['desc']?>"
                                    >
                                        <?php echo $article['desc']?>
                                    </a>
                                   </li>
                            <?php endforeach?>
                        </ul>
                    <?php endif?>
                        <?php if (count($consultation['questions']) > 0): ?>
                            <h4>Fragen</h4>
                            <ul>
                                <?php foreach ($consultation['questions'] AS $question): ?>
                                    <li>
                                        <a
                                            href="<?php echo $this->baseUrl()?>/question/show/kid/<?php echo $consultation['cid']?>/qid/<?php echo $question['qi']?>"
                                            title="<?php echo $question['q']?>"
                                        >
                                            <?php echo $question['q']?>
                                        </a>
                                        <br />
                                        <?php echo strip_tags($question['q_xpl'])?>...
                                    </li>
                                <?php endforeach?>
                            </ul>
                    <?php endif?>

                    <?php if (count($consultation['inputs']) > 0): ?>
                        <h4>Nutzerbeitr&auml;ge</h4>
                        <ul>
                            <?php foreach ($consultation['inputs'] AS $input): ?>
                                <li>
                                    <a
                                        href="<?php echo $this->baseUrl()?>/input/show/kid/<?php echo $consultation['cid']?>/qid/<?php echo $input['qi']?>#input-<?php echo $input['tid']?>"
                                        title="' . $thes . '"
                                    >
                                        <?php echo stripslashes(strip_tags($input['thes']))?>
                                    </a>
                                    <br />
                                    <?php echo $this->perex($input['expl'], 150, array('HTML_ENTITY_DECODE', 'STRIP_TAGS', 'STRIPSLASHES'))?>
                                </li>
                            <?php endforeach?>
                        </ul>
                    <?php endif?>
                <?php endif?>
            <?php endforeach?>
        <?php endif?>

        <h2>Suche in Follow-ups</h2>
        <ul class="followup-search media-list">
            <?php foreach ($this->resultsFollowUps as $followUp): ?>
                <li>
                    <div class="followup-preview media">
                        <a
                            href="<?php echo $this->baseUrl() . '/media/consultations/' . $followUp['consultationId'] . '/' . $followUp['filename']?>"
                            class="followup-image pull-left"
                        >
                            <img
                                src="<?php echo $this->baseUrl() . '/media/consultations/' . $followUp['consultationId'] . '/' . $followUp['filenameThumb']?>"
                                alt="<?php echo $followUp['title']?>"
                            />
                        </a>
                        <div class="media-body">
                            <a href="<?php echo $this->baseUrl() . '/media/consultations/' . $followUp['consultationId'] . '/' . $followUp['filename']?>">
                                <h3 class="followup-title"><?php echo $followUp['title']?></h3>
                            </a>
                            <time class="followup-time">
                                <?php if ($followUp['showNoDay'] == 'y'): ?>
                                    <?php echo $this->formatDate($followUp['timeReleased'], Zend_Date::MONTH_NAME . ' ' . Zend_Date::YEAR)?>
                                <?php else:?>
                                    <?php echo $this->formatDate($followUp['timeReleased'])?>
                                <?php endif?>
                            </time><br />
                            <p class="followup-author"><?php echo $followUp['releasedBy']?></p>

                            <h4>Reaktionen:</h4>
                            <ul>
                                <?php foreach ($followUp['snippets'] as $snippet): ?>
                                    <li class="level-<?php echo $snippet['hierarchyLevel']?>">
                                        <p class="followup-snippet">
                                            <?php echo html_entity_decode($snippet['text'])?>
                                        </p>
                                    </li>
                                <?php endforeach?>
                            </ul>
                        </div>
                    </div><!-- .followup-preview -->
                </li>
            <?php endforeach?>
        </ul>

     </article>

</div><!-- .main-content -->
