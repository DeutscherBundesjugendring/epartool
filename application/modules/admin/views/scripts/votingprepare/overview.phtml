<section class="section-header has-tabs">
    <div class="container">

        <h1><?=$this->consultation['titl'];?></h1>
        <h2><?=$this->consultation['titl_sub'];?></h2>

        <?=$this->consultationTabs($this->consultation['kid'], 'consultation');?>

    </div>
</section>
<section class="section-content">
    <div class="container">
        <div class="row">
            <div class="sidebar">

                <?=$this->consultationNavigation($this->consultation['kid'], 'voting-prepare');?>

            </div>
            <div class="content">

                <h2><?=$this->translate('Voting');?></h2>

                <div>
                    <h3><?=$this->translate('Folders');?></h3>
                    <a href="<?=$this->url(['action' => 'create-directory']);?>"><?=$this->translate('Add folder');?></a>
                    <form method="<?=$this->form->getMethod();?>" action="<?=$this->url(['action' => 'delete-directory']);?>">
                        <?=$this->form->getElement($this->form->getCsrfTokenName());?>
                        <ul>
                            <?php foreach($this->directories as $directory): ?>
                                <li>
                                    <?php for ($i = 0; $i < $directory['depth']; $i++): ?>
                                        &nbsp;&nbsp;&nbsp;
                                    <?php endfor;?>
                                    <?=$directory['dir_name'];?> (<?=$directory['count'];?>)
                                    <button
                                        class="btn btn-default item-action item-action-danger"
                                        name="delete"
                                        value="<?=$directory['id']?>"
                                        data-toggle="confirm"
                                        data-confirm-message="<?=$this->translate('Delete directory?');?>"
                                    >
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </li>
                            <?php endforeach?>
                        </ul>
                    </form>
                </div>

                <div>
                    <h3><?=$this->translate('Search');?></h3>
                    <form method="get">
                        <div class="row">
                            <div class="form-group">
                                <input
                                    name="fulltext"
                                    type="text"
                                    value="<?=$this->fulltext;?>"
                                />
                            </div>
                            <div class="form-actions">
                                <button
                                    type="submit"
                                    class="btn btn-default"
                                >
                                    <?=$this->translate('Search');?>
                                </button>
                            </div>
                        </div><!-- .row -->
                    </form>
                </div>

                <div>
                    <h3><?=$this->translate('Filter');?></h3>
                    <form data-target="#contribution-table tr">
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label><?=$this->translate('Admin Confirmation');?></label>
                                    <select
                                        class="form-control"
                                        data-toggle="filter"
                                        data-target-attrib="admin-confirmation"
                                        data-filter-operator="="
                                    >
                                        <option value=""><?=$this->translate('All');?></option>
                                        <option value="u"><?=$this->translate('Waiting for revision');?></option>
                                        <option value="n"><?=$this->translate('Confirmed');?></option>
                                        <option value="y"><?=$this->translate('Blocked');?></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label></span> <?=$this->translate('Origin');?></label>
                                    <select
                                        class="form-control"
                                        data-toggle="filter"
                                        data-target-attrib="origin"
                                        data-filter-operator="="
                                    >
                                        <option value=""><?=$this->translate('All');?></option>
                                        <option value="userCreated"><?=$this->translate('User created');?></option>
                                        <option value="adminCreated"><?=$this->translate('Admin created');?></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label><?=$this->translate('Voting');?></label>
                                    <select
                                        class="form-control"
                                        data-toggle="filter"
                                        data-target-attrib="voting"
                                        data-filter-operator="="
                                    >
                                        <option value=""><?=$this->translate('All');?></option>
                                        <option value="u"><?=$this->translate('Unknown');?></option>
                                        <option value="y"><?=$this->translate('Allowed');?></option>
                                        <option value="n"><?=$this->translate('Blocked');?></option>
                                    </select>
                                </div>
                            </div>
                        </div><!-- .row -->

                        <div class="row">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label><?=$this->translate('Folder');?></label>
                                    <select
                                        class="form-control"
                                        data-toggle="filter"
                                        data-target-attrib="directory"
                                        data-filter-operator="="
                                    >
                                        <option value=""><?=$this->translate('All folders');?></option>
                                        <option value="0"><?=$this->translate('Folder root');?></option>
                                        <?php foreach($this->directories as $directory): ?>
                                            <option value="<?=$directory['id'];?>">
                                                <?php for ($i = 0; $i < $directory['depth']; $i++): ?>
                                                    &nbsp;&nbsp;&nbsp;
                                                <?php endfor;?>
                                                <?=$directory['dir_name'];?> (<?=$directory['count'];?>)
                                            </options>
                                        <?php endforeach?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="tags"><?=$this->translate('Tags');?></label>
                                    <select
                                        name="tags[]"
                                        class="form-control js-select2"
                                        multiple
                                        data-toggle="filter"
                                        data-target-attrib="tags"
                                    >
                                        <?php foreach ($this->tags as $tag): ?>
                                            <option
                                                value="<?=$tag['tg_nr'];?>"
                                                <?=!empty($tag['selected']) ? 'selected="selected"' : '';?>
                                            >
                                                <?=$tag['tg_de'];?>
                                            </option>
                                        <?php endforeach;?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <button
                                    type="button"
                                    class="btn btn-default"
                                    data-toggle="reset-filter"
                                >
                                    <?=$this->translate('Reset Filter');?>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div>
                    <h3><?=$this->translate('Inputs');?></h3>
                    <form method="<?=$this->form->getMethod();?>" action="<?=$this->url(['action' => 'list-control']);?>">
                        <div>
                            <?=$this->form->getElement($this->form->getCsrfTokenName());?>
                            <?=$this->translate('Marked entries');?>
                            <button class="btn btn-default" name="merge" value="1" type="submit">
                                <?=$this->translate('Merge');?>
                            </button>
                            <button
                                class="btn btn-default"
                                name="releaseBulk"
                                type="submit"
                                value="1"
                                data-toggle="confirm"
                                data-confirm-message="<?=$this->translate('Release inputs?');?>"
                            >
                                <?=$this->translate('Release');?>
                            </button>
                            <button
                                class="btn btn-default"
                                name="blockBulk"
                                type="submit"
                                value="1"
                                data-toggle="confirm"
                                data-confirm-message="<?=$this->translate('Block inputs?');?>"
                            >
                                <?=$this->translate('Block');?>
                            </button>
                            <button
                                class="btn btn-default"
                                name="enableVotingBulk"
                                type="submit"
                                value="1"
                                data-toggle="confirm"
                                data-confirm-message="<?=$this->translate('Set inputs for voting?');?>"
                            >
                                <?=$this->translate('Allow for voting');?>
                            </button>
                            <button
                                class="btn btn-default"
                                name="blockVotingBulk"
                                type="submit"
                                value="1"
                                data-toggle="confirm"
                                data-confirm-message="<?=$this->translate('Ban inoputs from voting?');?>"
                            >
                                <?=$this->translate('Ban from voting');?>
                            </button>
                            <button
                                class="btn btn-default"
                                name="deleteBulk"
                                type="submit"
                                value="1"
                                data-toggle="confirm"
                                data-confirm-message="<?=$this->translate('Delete inputs?');?>"
                            >
                                <?=$this->translate('Delete');?>
                            </button>

                            <select name="sendToDictionaryId">
                                <option value="0"><?=$this->translate('Folder root');?></option>
                                <?php foreach($this->directories as $directory): ?>
                                    <option value="<?=$directory['id'];?>">
                                        <?php for ($i = 0; $i < $directory['depth']; $i++): ?>
                                            &nbsp;&nbsp;&nbsp;
                                        <?php endfor;?>
                                        <?=$directory['dir_name'];?> (<?=$directory['count'];?>)
                                    </options>
                                <?php endforeach?>
                            </select>
                            <button
                                class="btn btn-default"
                                name="sendToDictionaryBulk"
                                type="submit"
                                value="1"
                                data-toggle="confirm"
                                data-confirm-message="<?=$this->translate('Move inputs?');?>"
                            >
                                <?=$this->translate('Add to folder');?>
                            </button>
                        </div>

                        <div>
                            <table id="contribution-table">
                                <tbody>
                                    <?php foreach ($this->inputs as $input): ?>
                                        <?=$this->partial('_partials/votingprepare/inputs.phtml', ['input' => $input])?>
                                    <?php endforeach;?>
                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>
</section>
