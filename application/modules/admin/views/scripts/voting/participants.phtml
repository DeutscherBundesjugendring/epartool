<section class="section-header has-tabs">
    <div class="container">

        <h1><?=$this->consultation['titl'];?></h1>
        <h2><?=$this->consultation['titl_sub'];?></h2>

        <?=$this->consultationTabs($this->consultation['kid'], 'consultation');?>

    </div>
</section>
<section class="section-content">
    <div class="container">
        <div class="row">
            <div class="sidebar">

                <?=$this->consultationNavigation($this->consultation['kid'], 'voting-participants');?>

            </div>
            <div class="content">

                <h2><?=$this->translate('Voting Participants');?></h2>

                <?php
                $memberships = array(
                    'y' => 'bestätigt',
                    'n' => 'abgelehnt',
                    'u' => '--offen--',
                );
                $identity = Zend_Auth::getInstance()->getIdentity();
                ?>

                <p><b>Anzahl Abstimmende:</b> <?=count($this->groups);?></p>
                <?php if (!empty($this->groups)): ?>
                    <table class="table">
                        <tr>
                            <th>Gruppe</th>
                            <th>Abstimmende_r</th>
                            <th>Gruppenmitglied</th>
                            <th>Noch abstimmen</th>
                            <th>Aktion</th>
                            <th>Abstimmungsteilnehmer:</th>
                        </tr>
                        <?php foreach ($this->groups as $group): ?>
                            <tr>
                                <td>
                                    <a href="<?=$this->url(['controller' => 'input', 'action' => 'list', 'uid' => $group['uid']]);?>">
                                        <?=$group['email'];?>
                                    </a>
                                    <br/>
                                    <?=$group['name'];?>
                                </td>
                                <td><?=$group['sub_user'];?></td>
                                <td><?=$memberships[$group['member']];?></td>
                                <td><?=substr_count($group['vt_inp_list'], ',');?></td>
                                <td>
                                    <?php if (($group['member'] == "y" && $identity->lvl == "adm") || $group['member'] == "u"): ?>
                                        <a href="<?=$this->url(['action' => 'participantdeny', 'uid' => $group['uid'], 'sub_uid' => $group['sub_uid']]);?>">
                                            Ablehnen
                                        </a>
                                        <br/>
                                    <?php endif;?>
                                    <?php if (($group['member'] == "n" && $identity->lvl == "adm")
                                        || ($group['member'] == "u" && $identity->lvl == "adm")
                                    ): ?>
                                        <a href="<?=$this->url(['action' => 'participantconfirm', 'uid' => $group['uid'], 'sub_uid' => $group['sub_uid']]);?>">
                                            Bestätigen
                                        </a>
                                        <br/>
                                    <?php endif;?>
                                    <?php if ($group['member'] == "n" && $identity->lvl == "adm"): ?>
                                        <a
                                            href="<?=$this->url(['action' => 'participantdelete', 'uid' => $group['uid'], 'sub_uid' => $group['sub_uid']]);?>"
                                            class="deleteconfirm"
                                        >
                                            Löschen
                                        </a>
                                        <br/>
                                    <?php endif;?>
                                </td>
                                <td>
                                    <a href="<?=$this->url(['action' => 'participantedit', 'uid' => $group['uid'], 'sub_uid' => $group['sub_uid']]);?>">
                                        zusammenführen
                                    </a>
                                    <br/>
                                </td>
                            </tr>
                        <?php endforeach;?>
                    </table>
                <?php endif;?>

            </div>
        </div>
    </div>
</section>

<!-- TODO move to JS -->
<script type="text/javascript">
    $(document).ready(function() {
        $('.deleteconfirm').click(function() {
            if (!confirm('Wollen Sie diesen Datensatz wirklich löschen?')) {
                return false;
            }
        });
    });
</script>
